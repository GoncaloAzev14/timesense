
= Modelo de Dados

== Utilizadores

[mermaid, target=modelo_utilizadores]
ifdef::env-github[[source, mermaid]]
----
erDiagram

    users ||--o{ users: "line_manager"
    job_titles ||--o{ users: "job_title"

    users ||--o{ user_user_groups: "user_id"
    users ||--o{ user_roles: "user_id"
    user_roles }o--|| roles: "role_id"
    user_user_groups }o--|| user_groups: "group_id"

    roles ||--o{ user_group_roles: "role_id"
    user_groups ||--o{ user_group_roles: "group_id"

    resource_permissions
----

== Projectos

[mermaid, target=modelo_projectos]
ifdef::env-github[[source, mermaid]]
----
erDiagram
    tasks ||--o{ project_type_tasks: "task_id"
    project_type_tasks }o--|| project_types: "type_id"

    tasks ||--o{ project_tasks: "task_id"
    project_tasks }o--|| projects: "project_id"

    project_types ||--o{ projects: "type_id"
    projects }o--|| clients: "client_id"
    projects }o--|| users: "manager_id"


    time_records }o--|| users: "user_id"
    time_records }o--|| projects: "approver_id"
    tasks ||--o{ time_records: "task_id"
----

== Ausências

[mermaid, target=modelo_ausencias]
ifdef::env-github[[source, mermaid]]
----
erDiagram

    absences }o--|| users: "user_id"
    absences }o--|| projects: "approver_id"
    absences }o--|| absence_types: ""
    absences }o--|| absence_sub_types: ""

    holidays

----

== Tabelas

=== users

[cols="2,1,3"]
|===
h| Nome:      2+| users
h| Descrição: 2+| Utilizadores da aplicação
3+h| Atributos
h| Nome                     h| Tipo         h| Descrição
| id                         | INT           | Código do utilizador
| name                       | STRING        | Nome do utilizador
| email                      | STRING        | Email do utilizador
| birthdate                  | DATE          | Data de nascimento do utilizador
| line_manager               | INT           | Manager responsável
| current_year_vacation_days | INT           | Número de dias de férias disponíveis
| prev_year_vacation_days    | INT           | Nº de dias de férias disponiveis do ano passado
| job_title                  | INT           | Id da função do colaborador
| admission_date             | DATE          | Data de entrada na empresa
| exit_date                  | DATE          | Data de saída da empresa
| created_at                 | TIMESTAMP     | Data da criação do registo
| updated_at                 | TIMESTAMP     | Ultima data de atualizacao do registo
| created_by                 | INT           | Utilizador que criou o registo
| updated_by                 | INT           | Último utilizador que atualizou o registo
| deleted                    | BOOLEAN       | Ignorar o registo se `true`
|===


=== job_titles

[cols="1,1,2"]
|===
h| Nome:      2+| job_titles
h| Descrição: 2+| Funções dentro da organizacao
3+h| Atributos
h| Nome           h| Tipo         h| Descrição
| id               | INT           | Código do Titulo
| name             | STRING        | Nome do Título
| rate             | NUMERIC       | Rate de custo
| start_date       | TIMESTAMP     | Data de inicio de validade
| end_date         | TIMESTAMP     | Data de fim de validade
| deleted          | BOOLEAN       | Ignorar o registo se `true`
|===

=== clients

[cols="1,1,2"]
|===
h| Nome:      2+| clients
h| Descrição: 2+| Clientes
3+h| Atributos
h| Nome           h| Tipo         h| Descrição
| id               | INT           | Código do Cliente
| name             | STRING        | Nome do Cliente
| client_ticker    | STRING        | Abreviatura do cliente (para cod. projecto)
| deleted          | BOOLEAN       | Ignorar o registo se `true`
|===

=== project_types

[cols="1,1,2"]
|===
h| Nome:      2+| project_types
h| Descrição: 2+| Tipos de projecto
3+h| Atributos
h| Nome           h| Tipo         h| Descrição
| id               | INT           | Código do tipo de projecto
| name             | STRING        | Nome do tipo de projecto
| description      | STRING        | Descrição do tipo de projecto
| line_manager     | BOOLEAN       | `true` se é o line manager que aprova os tempos
| deleted          | BOOLEAN       | Ignorar o registo se `true`
|===

=== projects

[cols="1,1,2"]
|===
h| Nome:      2+| projects
h| Descrição: 2+| Projectos
3+h| Atributos
h| Nome            h| Tipo         h| Descrição
| id                | INT           | Código interno do projecto
| name              | STRING        | Código do projecto
| description       | STRING        | Nome do projecto
| type_id           | INT           | Tipo do projecto
| manager           | INT           | Código do gestor de projecto
| client_id         | INT           | Código do cliente do projecto
| start_date        | TIMESTAMP     | Data de inicio do projecto
| expected_due_date | TIMESTAMP     | Data esperada de fim do projecto
| end_date          | TIMESTAMP     | Data de fim do projecto
| status_id         | INT           | Código do status do projecto
| real_budget       | NUMERIC       | Custo esperado para o projecto
| created_at        | TIMESTAMP     | Data da criação do registo
| updated_at        | TIMESTAMP     | Ultima data de atualizacao do registo
| created_by        | INT           | Utilizador que criou o registo
| updated_by        | INT           | Último utilizador que atualizou o registo
| deleted           | BOOLEAN       | Ignorar o registo se `true`
|===

=== tasks

[cols="1,1,2"]
|===
h| Nome:      2+| tasks
h| Descrição: 2+| Tarefas de projecto
3+h| Atributos
h| Nome           h| Tipo         h| Descrição
| id               | INT           | Código da tarefa
| name             | STRING        | Nome da tarefa
| description      | STRING        | Descrição da tarefa
| updated_by       | INT           | Utilizador que atualizou a tarefa
| deleted          | BOOLEAN       | Ignorar o registo se `true`
|===

=== project_tasks

[cols="1,1,2"]
|===
h| nome:      2+| project_tasks
h| descrição: 2+| tarefas de projecto
3+h| atributos
h| nome           h| tipo         h| descrição
| project_id       | int           | código do projecto
| project_task_id  | int           | código da tarefa
|===

=== project_type_tasks

[cols="1,1,2"]
|===
h| nome:      2+| project_type_tasks
h| descrição: 2+| tarefas default do tipo de projecto
3+h| atributos
h| nome           h| tipo         h| descrição
| project_type_id  | int           | código do tipo de projecto
| project_task_id  | int           | código da tarefa
|===

=== absence_types

[cols="1,1,2"]
|===
h| nome:      2+| absence_types
h| descrição: 2+| Tipos de ausência
3+h| atributos
h| nome           h| tipo          h| descrição
| id              | int            | Código
| name            | string         | Nome da ausencia
| created_at      | TIMESTAMP      | Data da criação do registo
| updated_at      | TIMESTAMP      | Ultima data de atualizacao do registo
|===

=== absence_sub_types

[cols="1,1,2"]
|===
h| nome:      2+| absence_sub_types
h| descrição: 2+| Subtipos de ausência (só para o tipo ABSENCES)
3+h| atributos
h| nome           h| tipo          h| descrição
| id              | int            | Código
| name            | string         | Nome da ausencia
| created_at      | TIMESTAMP      | Data da criação do registo
| updated_at      | TIMESTAMP      | Ultima data de atualizacao do registo
|===

=== absences

[cols="1,1,2"]
|===
h| nome:      2+| absences
h| descrição: 2+| Ausencias planeadas
3+h| atributos
h| nome           h| tipo                       h| descrição
| id               | integer                     | Código da ausência
| type_id          | bigint                      | Tipo de ausencia
| user_id          | bigint                      | Utilizador
| name             | character varying(100)      | Descrição da ausencia
| approved_date    | timestamp with time zone    | Data de aprovação
| start_date       | timestamp with time zone    | Inicio do periodo de ausencia
| end_date         | timestamp with time zone    | Fim do periodo de ausencia
| approver         | bigint                      | Utilizador que deve aprovar
| approved_by      | bigint                      | Utilizador que aprovou
| status_id        | bigint                      | Estado da ausencia
| reason           | character varying(100)      | Motivo da ausencia
| work_days        | double precision            | Nº de dias uteis da ausencia
| business_year    | character varying(10)       | Ano fiscal a que diz respeito
| observations     | character varying(200)      | Razão para a rejeição
| created_at       | TIMESTAMP                   | Data da criação do registo
| updated_at       | TIMESTAMP                   | Ultima data de atualizacao do registo
| created_by       | INT                         | Utilizador que criou o registo
| updated_by       | INT                         | Último utilizador que atualizou o registo
| deleted          | boolean                     | Ignorar o registo se `true`
| sub_type_id      | bigint                      | Subtipo de ausencia
| record_type      | character varying(100)      | ??????
| absence_hours    | double precision            | nº de horas de ausencia
|===

=== time_records

[cols="1,1,2"]
|===
h| nome:      2+| time_records
h| descrição: 2+| Registos de tempo
3+h| atributos
h| nome       h| tipo                       h| descrição
| id          | integer                     | Id do registo
| user_id     | bigint                      | Utilizador do registo
| project_id  | bigint                      | Id do projecto
| task_id     | bigint                      | Código da tarefa
| hours       | numeric                     | Nº de horas registadas
| description | text                        | Comentários ao registo de tempo
| status_id   | bigint                      | Estado do registo
| start_date  | timestamp with time zone    | Inicio do registo
| end_date    | timestamp with time zone    | Fim do registo
| approved_by | bigint                      | Aprovador
| approved_at | timestamp without time zone | Momento da aprovação
| created_at  | TIMESTAMP                   | Data da criação do registo
| updated_at  | TIMESTAMP                   | Ultima data de atualizacao do registo
| created_by  | INT                         | Utilizador que criou o registo
| updated_by  | INT                         | Último utilizador que atualizou o registo
| deleted     | boolean                     | Ignorar o registo se `true`
| reason      | character varying(100)      | Motivo da rejeição do registo
|===

=== holidays

[cols="1,1,2"]
|===
h| nome:      2+| holidays
h| descrição: 2+| Dias feriados
3+h| atributos
h| nome        h| tipo     h| descrição
| id           | integer   | Id do registo
| holiday_date | date      | Data do feriado
| name         | string    | Nome do feriado
| deleted      | boolean   | Ignorar o registo se `true`
|===

